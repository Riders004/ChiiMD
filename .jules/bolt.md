## 2024-07-25 - Reduce Unnecessary Database Writes (Attempted)

**Learning:** An attempt was made to reduce unnecessary disk I/O by introducing a "dirty" flag to track changes to the in-memory database (`global.db.data`). However, the implementation proved to be critically unsafe. In a plugin-based architecture where dozens of plugins can directly mutate the global database object, it is nearly impossible to manually instrument every single mutation point. This creates a high risk of silent data loss, where a plugin could modify data that is never written to disk. The manual approach is too fragile and error-prone for this codebase.

**Action:** Reverted the attempted change. For this optimization to be implemented safely, a more robust, centralized mechanism is required. The ideal solution would be to wrap `global.db.data` in a `Proxy` object. The `Proxy` would intercept all write operations (sets, deletes) and automatically set the dirty flag, ensuring that *every* change is tracked without requiring manual intervention in every plugin. This would eliminate the risk of data loss and provide a reliable way to optimize database writes. Avoid manual dirty-flag tracking in the future.

## 2026-02-04 - Optimize Hot Paths in Message Handling and DB Initialization
**Learning:** High-frequency message handling in a plugin-based architecture can be severely bottlenecked by redundant O(N) regex matching, dynamic imports, and frequent object re-allocations during database initialization. Moving constants and utility functions out of the message loop and using in-place mutations for proxied database objects significantly improves throughput and reduces disk I/O.
**Action:** Always pre-calculate expensive operations (like prefix matching) once per message, use static imports where possible, and prefer in-place updates for missing properties in proxied objects to avoid unnecessary 'dirty' flag triggers.
